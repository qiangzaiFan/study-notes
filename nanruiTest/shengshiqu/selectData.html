<!DOCTYPE html>
<html>
  <head>
    <title>Vue Demo</title>
    <meta charset="utf-8" />
    <!-- 引入Vue.js -->
    <script type="text/javascript" src="./vue.min.js"></script>
    <style>
      html,
      body,
      #app {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      h4 {
        margin-top: 16px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div>
        <a-cascader :options="options" v-model="selectedValue" @change="onChange" placeholder="请选择省/市/区" />
        <a-button @click="toggleModal" style="margin-top: 16px">修改数据</a-button>
        <a-modal v-model="isModalVisible" title="修改数据" @ok="handleOk" @cancel="handleCancel">
          <div>
            <h4>新省</h4>
            <a-input v-model="newProvince" placeholder="输入省名" />
            <h4>新市</h4>
            <a-input v-model="newCity" placeholder="输入市名" />
            <h4>新区</h4>
            <a-input v-model="newDistrict" placeholder="输入区名" />
          </div>
        </a-modal>
      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        data() {
          return {
            options: [],
            selectedValue: [],
            isModalVisible: false,
            newProvince: '',
            newCity: '',
            newDistrict: ''
          }
        },
        created() {
          fetch('http://localhost:3000/data')
            .then(res => {
              return res.json()
            })
            .then(json => {
              console.log('---json,', json)
              this.citiesData = json
              this.initializeOptions()
            })
        },
        methods: {
          initializeOptions() {
            this.options = this.citiesData.map(province => ({
              value: province.code,
              label: province.name,
              children: province.cities.map(city => ({
                value: city.code,
                label: city.name,
                children: city.districts.map(district => ({
                  value: district.code,
                  label: district.name
                }))
              }))
            }))
          },
          onChange(value) {
            console.log(value)
          },
          toggleModal() {
            this.isModalVisible = !this.isModalVisible
          },
          handleOk() {
            if (this.newProvince) {
              const province = this.citiesData.find(p => p.name === this.newProvince)
              if (!province) {
                // 如果省不存在，创建新的省
                const newProvinceData = {
                  name: this.newProvince,
                  code: `00${this.citiesData.length + 1}`,
                  cities: []
                }
                this.citiesData.push(newProvinceData)
              }
              this.clearInputs()
              this.initializeOptions()
            }
            this.toggleModal()
          },
          handleCancel() {
            this.clearInputs()
            this.toggleModal()
          },
          clearInputs() {
            this.newProvince = ''
            this.newCity = ''
            this.newDistrict = ''
          }
        }
      })
    </script>
  </body>
</html>
